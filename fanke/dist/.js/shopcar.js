"use strict";$(document).ready(function(){function n(t){var e=t.map(function(t){return html='<tr class="selected" data-id='+t.id+'>\n                            <td class="white bd-left">\n                                &nbsp;\n                            </td>\n                            <td class="bar" rowspan="1">\n                                <input type="checkbox"  id=\'selector\'class="track ckb SELECT" name="p-item" data-del-tip="" value="" issupplier="False" shopid="10258" selectedclothescode="15798553" >\n                            </td>\n                            <td class="image" rowspan="1">\n                                <a target="_blank" href="http://item.vancl.com/6383118.html?ref=hp-hp-YSVT-1_2-v:n">\n                                    <img alt="卫衣 复合双层绒 连帽 男款 深花灰/黑色" src="'+t.url+'"></a>\n                            </td>\n                            <td class="name">\n                                \n                                    '+t.title+'\n                                     \n                                \n                            </td>\n                            <td class="size">\n                                \n                                    M\n                                \n                            </td>\n                            <td class="presentpoints" style="display: none">\n                                3,980分\n                            </td>\n                            <td class="price">\n                                ￥'+t.price+".00\n                            </td>\n                            <td class=\"qty\">\n                                <input type=\"button\"  class='sub' value='—'/><input type=\"text\" class='num'/ value='"+t.num+'\'><input type="button" class=\'add\' value="+" />\n                                \n                                \n                            </td>\n                            <td>\n                                    -\n                            </td>\n                            <td class="SUBtotal">\n                               &yen;'+t.price*t.num+'.00\n                            </td>\n                            <td class="operate">\n                                <a class="del track"  >\n                                                     删除</a>\n                            </td>\n                            <td class="white bd-right">\n                                &nbsp;\n                            </td>\n                        </tr>'}).join("");$("tbody").html(e)}$(window).scroll(function(){var t=$("table").outerHeight(),e=$(window).scrollTop();console.log(t),e<t?$(".carmain_bottom").addClass("fix"):$(".carmain_bottom").removeClass("fix")});function a(t,e){var n=t.parent().parent().attr("data-id");ajax("GET","../api/updataOrders.php","id="+n+"&num="+e,function(t){})}function r(t){var e=$.trim(t.parent().prev().text()).substring(1),n=t.parent().children().eq(1).val(),a=(e*n).toFixed(2);console.log(n,e,a),t.parent().next().next().text("￥"+a)}ajax("GET","../api/selectOrders.php","",function(t){n($.parseJSON(t))}),$("tbody").delegate(".del","click",function(){var t=$(this).parent().parent().attr("data-id");console.log(t);var e="id="+t+"&time="+new Date;ajax("GET","../api/deleteOrders.php",e,function(t){n($.parseJSON(t))})}),$("tbody").delegate(".num","keyup",function(){var t=$(this).val();a($(this),t),$(this).val(t),i()}),$("tbody").delegate(".sub","click",function(){var t=$(this).next().val();--t<=1&&(t=1);var e=$(this);a(e,t),$(this).next().val(t),r(e),i()}),$("tbody").delegate(".add","click",function(){$(this).parent().parent().attr("data-id");var t=$(this).prev().val();t++;var e=$(this);a(e,t),$(this).prev().val(t),r(e),i()}),$("tbody").delegate(".SELECT","click",function(){$(this).is(":checked")?$(this).parent().parent().css("background-color","pink"):$(this).parent().parent().css("background-color","")});var t=!0;$("tbody").delegate("#selector","click",function(){i(),t=c.length==$(".SUBtotal").size()?($(".carmain_bottom_up input").prop("checked","checked"),!1):($(".carmain_bottom_up input").removeAttr("checked"),!0)}),$(".carmain_bottom_up input").on("click",function(){t?($(this).prop("checked","checked"),$(".bar input").prop("checked","checked"),$(".bar").parent().css("background-color","pink")):($(this).removeAttr("checked"),$(".bar input").removeAttr("checked"),$(".bar").parent().css("background-color","")),t=!t,i()});var c=[];function i(){c.length=0;for(var t=$(".bar input").size(),e=0;e<t;e++)$(".bar input").eq(e).prop("checked")&&c.push(e);var n=0,a=0;for(e=0;e<c.length;e++){n+=1*$(".qty .num").eq(c[e]).val();var r=$(".SUBtotal").eq(c[e]).text();a+=r=1*(r=$.trim(r)).substring(1)}$("#allnum").html("已选"+n+" 件商品"),$("#totalprice").html(a.toFixed(2))}$(".delall").click(function(){if(confirm("确定要全部删除吗？")){i();for(var t=[],e=0;e<c.length;e++){var n=$(".SELECT").eq(c[e]).parent().parent().attr("data-id");t.push(n)}var a=t.join();for(e=c.length-1;0<=e;e--)$(".SELECT").eq(c[e]).parent().parent().remove();ajax("GET","../api/delmore.php","id="+a,function(t){"yes"==t&&console.log("删除成功")})}})});